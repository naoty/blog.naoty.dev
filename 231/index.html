<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftでNSDateを簡単に扱うライブラリを書いた</title>
    <meta property="og:title" content="SwiftでNSDateを簡単に扱うライブラリを書いた">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blog.naoty.dev/231/">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@naoty_k">
    <meta name="theme-color" content="#fff">
    <link href="/feed.xml" rel="alternate" type="application/atom+xml">
    <link href="/normalize.css" rel="stylesheet">
    <link href="/main2.css" rel="stylesheet">
    <link href="/highlight.css" rel="stylesheet">
    <link href="/favicon.png" rel="shortcut icon" type="image/png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icon-192.png">
    <link rel="canonical" href="https://naoty.dev/posts/231">
  </head>
  <body>
    <main>
      <article>
        <header>
          <h1 class="title mt-0">SwiftでNSDateを簡単に扱うライブラリを書いた</h1>
          <p class="metadata">
            <time datetime="2014-08-17T16:39:00.000+0000">2014-08-17 16:39</time>
            <a href="/oss/">#oss</a>
          </p>
        </header>
        <section class="body">
          <p>Swiftの実験的なプロジェクトとしてActiveSupportの拡張っぽく直感的に時間を扱うライブラリ"Timepiece"というものを書いた。</p>
<p><a href="https://github.com/naoty/Timepiece">naoty/Timepiece · GitHub</a></p>
<h1>demo</h1>
<pre><code>let today = NSDate.today()
let tomorrow = NSDate.tomorrow()
let dayAfterTomorrow = tomorrow + 1.day
let dayBeforeYesterday = 2.days.ago
let birthday = NSDate.date(year: 1987, month: 6, day: 2)
</code></pre>
<h1>機能</h1>
<ul>
<li>
<code>1.day.ago</code>（1日前）、<code>4.years.later</code>（4年後）というように<code>Int</code>型を拡張し、<code>数.単位.前/後</code>という書き方で<code>NSDate</code>オブジェクトを初期化できる。単位は単数形、複数形どちらも使える。</li>
<li>
<code>NSDate() + 1.minute</code>（1分後）、<code>NSDate() - 3.hours</code>（3時間前）というように、<code>NSDate</code>オブジェクトから<code>数.単位</code>を加算・減算できる。</li>
<li>
<code>NSDate.date(year:month:day:hour:minute:second)</code>, <code>NSDate.today()</code>, <code>NSDate.yesterday()</code>, <code>NSDate.tomorrow()</code>というように、<code>NSDate</code>オブジェクトをより直感的に初期化できる。</li>
</ul>
<h1>今後</h1>
<ul>
<li>既存の<code>NSDate</code>オブジェクトの時間だけ変更したいとか、その日の0:00を取得したいという場合に対応したい。ActiveSupportとかmoment.jsの<code>beginning_of_day</code>, <code>endOf("day")</code>のようなやつ。</li>
<li>範囲オブジェクトのようなものを生成できるようにしたい。例えば、今日から1週間分の<code>NSDate</code>オブジェクトの範囲オブジェクトを作って繰り返し処理させられたら便利そう。</li>
</ul>
<h1>悩み</h1>
<p>こういうライブラリでよくあるのがパース処理とフォーマット処理なんだけど、このライブラリでサポートすべきかどうか悩む。というのも、この手の処理は<code>NSDateFormatter</code>オブジェクトを使うと思うのだけど、便利なAPIのせいで無意識にムダな<code>NSDateFormatter</code>オブジェクトを何度も生成してしまう可能性がありそうだなと懸念している。</p>
<h1>プルリクチャンス</h1>
<ul>
<li>こういう機能がほしいという希望があれば<a href="https://github.com/naoty/Timepiece/issues">issues</a>でどんどん要望を伝えてほしいです。</li>
<li>もちろん<a href="https://github.com/naoty/Timepiece/pulls">Pull request</a>も歓迎です。コード量は多くないので、ちょっと読めば何をしているか思います。テストはちゃんと書いてます。</li>
</ul>
        </section>
        <footer>
          <nav>
            <ul class="footer-links mb-0">
              <li class="footer-link"><a href="https://naoty.dev">Home</a></li>
              <li class="footer-link"><a href="/">Posts</a></li>
            </ul>
          </nav>
        </footer>
      </article>
    </main>
  </body>
</html>
