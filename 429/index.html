<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カスタムエラー型の定義</title>
    <link href="/normalize.css" rel="stylesheet">
    <link href="/main.css" rel="stylesheet">
    <link href="/favicon.png" rel="shortcut icon" type="image/png">
    <meta property="og:title" content="カスタムエラー型の定義">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blog.naoty.dev/429/">
    <meta property="og:image" content="https://blog.naoty.dev/icon.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:creator" content="@naoty_k">
    <link href="/feed.xml" rel="alternate" type="application/atom+xml">
  </head>
  <body>
    <main>
      <article>
        <header>
          <h1 class="title mt-0">カスタムエラー型の定義</h1>
          <p class="metadata">
            <time datetime="2020-08-19T21:24:00.000+0000">2020-08-19 21:24</time>
            <a href="/rust/">#rust</a>
          </p>
        </header>
        <section class="body">
          <pre lang="rust"><code>use std::{error, fmt};

#[derive(Debug)]
pub enum MyError {
  InvalidFormat,
}

impl fmt::Display for MyError {
  fn fmt(&amp;self, f: &amp;mut fmt::Formatter) -&gt; fmt::Result {
    match self {
      Self::InvalidFormat =&gt; write!(f, &quot;invalid format&quot;),
    }
  }
}

impl error::Error for MyError {}

fn main() {
  let error: Box = Box::new(MyError::InvalidFormat);
  eprintln!(&quot;error: {}&quot;, error);
}
</code></pre>
<ul>
<li><code>std::error::Error</code>トレイトは基本的なエラーの振る舞いを表す。</li>
<li><code>std::error::Error</code>トレイトは<code>Debug</code>トレイトと<code>Display</code>トレイトを継承しているため、まずはこの2つを実装する必要がある。</li>
<li><code>impl error::Error for MyError {}</code>という空の定義がないと、下のようなエラーになってしまうためこれも必要になる。
<pre><code>error[E0277]: the trait bound `MyError: std::error::Error` is not satisfied
  --&gt; src/main.rs:19:40
   |
19 |     let error: Box = Box::new(MyError::InvalidFormat);
   |                                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ the trait `std::error::Error` is not implemented for `MyError`
   |
   = note: required for the cast to the object type `dyn std::error::Error`
</code></pre>
</li>
</ul>
        </section>
        <footer>
          <nav>
            <ul class="footer-links mb-0">
              <li><a href="/">Posts</a></li>
            </ul>
          </nav>
        </footer>
      </article>
    </main>
  </body>
</html>
